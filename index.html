<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Interaction AR.js - Exercice 3 (pulsation + couleurs fixes)</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>
<body>
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">

        <!-- Caméra avec curseur -->
        <a-entity camera>
            <a-cursor 
                fuse="false" 
                raycaster="objects: .clickable">
            </a-cursor>
        </a-entity>

        <!-- Marqueur Hiro -->
        <a-marker preset="hiro">
            <a-box id="interactive-box" 
                   class="clickable"
                   position="0 0.5 0" 
                   color="blue"
                   material="opacity: 0.8; transparent: true;">
                   
                <!-- Animation de rotation lente par défaut -->
                <a-animation id="slow-rotation"
                             attribute="rotation"
                             from="0 0 0" to="0 360 0"
                             dur="4000"
                             easing="linear"
                             repeat="indefinite">
                </a-animation>
            </a-box>
        </a-marker>
        
    </a-scene>

    <script>
        const box = document.querySelector("#interactive-box");

        box.addEventListener("click", () => {
            // Passer en rouge
            box.setAttribute("color", "red");

            // Supprimer la rotation lente
            const slowRot = document.querySelector("#slow-rotation");
            if (slowRot) slowRot.remove();

            // Appliquer la rotation rapide
            box.setAttribute("animation__fastspin", {
                property: "rotation",
                to: "0 360 0",
                dur: 1000,
                easing: "linear",
                loop: true
            });

            // Appliquer la pulsation (zoom puis retour)
            box.setAttribute("animation__scale", {
                property: "scale",
                to: "1.5 1.5 1.5",
                dir: "alternate",
                dur: 500,
                loop: 2
            });

            // Après 2 secondes, rétablir l’état initial
            setTimeout(() => {
                box.removeAttribute("animation__fastspin");
                box.removeAttribute("animation__scale");

                // Réappliquer la rotation lente
                const newAnim = document.createElement("a-animation");
                newAnim.setAttribute("id", "slow-rotation");
                newAnim.setAttribute("attribute", "rotation");
                newAnim.setAttribute("from", "0 0 0");
                newAnim.setAttribute("to", "0 360 0");
                newAnim.setAttribute("dur", "4000");
                newAnim.setAttribute("easing", "linear");
                newAnim.setAttribute("repeat", "indefinite");
                box.appendChild(newAnim);

                // Réinitialiser la taille et la couleur
                box.setAttribute("scale", "1 1 1");
                box.setAttribute("color", "blue");
            }, 2000);
        });
    </script>
</body>
</html>
